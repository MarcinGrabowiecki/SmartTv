<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="CACHE-CONTROL" content="NO-CACHE" />
  <meta http-equiv="EXPIRES" content="Mon, 22 Jul 2002 11:12:01 GMT" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <style type="text/css">
/*<![CDATA[*/
	body		{ font-family: "Arial", Times, serif; }
	a			{margin:25px; padding:3px}
	a:link		{ color:#eeeeee; background-color:#111111; }
	a:visited	{ color:#c0c0c0; background-color:#222222; }
	a:hover		{ color:#eeeeee; background-color:#007777; }
	a:active	{ color:#f0f0f0; background-color:#00ff00; }
	span.sticky {
		xposition: -webkit-sticky; /* Safari */
		position: absolute;
		top: 0;
		left: 0;
		background-color: green;
		border: 2px solid #4CAF50;
		opacity: 0.7;
	}
  /*]]>*/
  </style>
  <link rel="icon" 
      type="image/png" 
      href="https://cdn3.iconfinder.com/data/icons/social-circle/512/social_4-512.png">

  <title>SmartTV Player</title>
</head>
<body  bgcolor="#111111" text="#eeeeee"  style="margin:0; padding:0">
<h2><span id="current" class="sticky">C</span></h2>
<video id="vid" width="30%" height="30%" controls>
  <source src="" type="video/mp4">
  <source src="" type="video/mp4">
Your browser does not support the video tag.
</video>
<p>
<a href="https://app-1512624596.000webhostapp.com/">reload</a>
<a href="#" onClick="controls()">toggle controls</a>
<a href="#" onClick="bookmark()">&#128278; bookmark</a>
<a href="#" onClick="restore()">restore</a>
</p>
<p>
<div id="linki">linki</div>
<div id="key">klawisze</div>
<div id="koment">kod klawisza</div>
<div id="bookmarks">-</div>
</p>
<script>

function play(s){
	localStorage["lastMovie"]=s;
	$("#vid").css("width", "100%");
	$("#vid").css("height", "100%");
	var video = $('#vid')[0];
	video.src = s; 
	video.load();
	var pp=video.play();
	pp.catch(function(m){showMessage("problem "+m);})
	//$("#vid > source").attr("src",s);
	//$("#vid").load();
	//$("#vid source").attr('src', s);
	//$("#vid").play();
	showMessage("play");
}

var message="";

function showMessage(m){
	$("#message").toggle(1000);
	message=m;
	setTimeout(function(){message="";$("#message").toggle(1000);},3000);
}

function controls(){
	document.getElementById("vid").controls=!document.getElementById("vid").controls;
}

var enter="";
var lastTimeout;

function goto(v){
	$("#vid")[0].currentTime=v[1]*60;
}

$(document).on("keypress", function (e) {
	$("#koment").text(e.keyCode);
	var keys={26:"{FAV}",37:"{LEFT}",38:"{UP}",39:"{RIGHT}",40:"{DOWN}",41:"{ECO}",42:"{ZOOM-}",49:"{ZOOM+}",50:"{TEXT}",56:"{SOURCE}",58:"{HOME}",60:"{PRE}",61:"{LIST}",403:"{RED}",404:"{GREEN}",405:"{YELLOW}",406:"{BLUE}"};
	if(keys[e.keyCode]&&!e.key) e.key=keys[e.keyCode];
	enter+=e.key;
	$("#key").text(e.keyCode+" "+e.key+" "+enter);
	if(lastTimeout) clearTimeout(lastTimeout);
	lastTimeout=setTimeout(function(){
		[
			{"reg":/^{RED}([0-9]*)/,"fun":goto},
			{"reg":/^{HOME}$/,"fun":function(){location.reload()}},
			{"reg":/^{TEXT}$/,"fun":controls},
			{"reg":/^{FAV}$/,"fun":bookmark},
			{"reg":/^{PRE}$/,"fun":unbookmark},
			{"reg":/^{BLUE}$/,"fun":del},
			{"reg":/^{GREEN}$/,"fun":function(){$( ".sticky" ).toggle(1000)}},
			{"reg":/^{YELLOW}$/,"fun":function(){$("#vid")[0].pause()}},
			{"reg":/^{DDD}$/,"fun":undefined}
		].forEach(function(e){
			var m=enter.match(e.reg);
			if(m) e.fun(m);
		});
			$("#key").text(enter);
			enter="";
	}, 2000);
})

$(document).ready(function(){
	$("#end").next().text("")
	$("#vid").on(
		"timeupdate", 
		function(event){
			goOnce();
			var ct=Math.round(this.currentTime/60);
			var max=Math.round(this.duration/60);
			var proc=Math.round(100*this.currentTime/this.duration);
		    $("#current").html(ct+"/"+max+"<div  style='background-color: red;width:"+proc+"%;height:2px'></div><div id='message'>"+message+"</div>"
);
			if(this.currentTime!=0) localStorage["lastMovie.currentTime"]=this.currentTime;
			if(ct==max) localStorage["lastMovie.currentTime"]=0;
		}
	);

var oldMsg;

function loader(){

$.ajax({
        method: "GET",
		cache: 'false',
        url: "https://docs.google.com/spreadsheets/d/1ZQb0V1Q0NpqstnI1KPc9zq37YPLrxU30kvlxEPdpi2E/export?format=tsv&id=1ZQb0V1Q0NpqstnI1KPc9zq37YPLrxU30kvlxEPdpi2E&gid=0",
        data: {
            name: "John"
        }
    })
    .done(function(msg,a,b) {
    	console.log(a)
    	console.log(b.getAllResponseHeaders())
        if (oldMsg != msg) {
        var html = "";
        msg.split("\n").forEach(function(e,i) {
            var w = e.split("\t");
            html += ("<span>");
            if (w[2].trim() != "play") {
                html += ("<a href='" + w[1] + "'>" + w[0] + "</a>");
            } else {
                html += '<a href="#" bla="aaaa" id="del'+i+'" onClick="play(' + "'" + w[1] + "')" + '"><b>&#8680;</b>' + w[0] + '</a>';
            }
            html += ("</span>");
        });
        $("#linki").html(html);
            oldMsg = msg;
        }


		$("a").mouseover(function(e){
			return;
			$("#mouseover").text("mmmmmmmmmmmmmmm");
			$("#mouseover").text("#mouseover "+JSON.stringify(e.target));
			window.toDel=e.target.id;
			console.log(e);
		})


		$("a").focus(function(e){
			$("#mouseover").text(JSON.stringify(e));
			console.log(e);
			console.log(JSON.stringify(e));
			//$("#mouseover").text("#focus "+JSON.stringify(e.target));
			window.toDel=e.target.id;
			console.log(e);
		})

    });
};

loader();
setInterval(loader,3000);
play(localStorage["lastMovie"])
});

$("#bookmarks").text(localStorage['bookmarks']);

function bookmark(){
	showMessage('bookmark');
	var b;
	if(localStorage['bookmarks']) {
		b=JSON.parse(localStorage['bookmarks']);
	}
	else {
		b=[];
	}
	b.push($("#vid")[0].currentTime);
	$("#bookmarks").text("#vid"+b);
	localStorage['bookmarks']=JSON.stringify(b);
}

function unbookmark(){
	showMessage('bookmark');
	var b=JSON.parse(localStorage['bookmarks']);
	$("#vid")[0].currentTime=b.pop();
	localStorage['bookmarks']=JSON.stringify(b);
}

function goOnce(){
	if(window.once){
	}else{
		window.once=true;
		console.log(localStorage["lastMovie.currentTime"]);
		$("#vid")[0].currentTime=localStorage["lastMovie.currentTime"];
	}
}

function del(){

console.log(this);

$.ajax({
        method: "GET",
		cache: 'false',
        url: "https://script.google.com/macros/s/AKfycbwMQEd6FI91OgLpKBzejeYkkFhSCarWrUh3giJJlxUE42VBr8mJ/exec",
        data: {
            command: "delete",
            id: window.toDel
        }
    })
    .done(function(msg) {
    	console.log(msg);
    });

}


</script>
<div id="end">...</div>
m
<div id="mouseover">mouseover</div>

<div id="help">
	<p><font color="red">REDnnn</font> - goto minnn</p>
	<p><font color="blue">BLUE</font> - del link</p>
	<p><font color="green">GREEN</font> - toggle status</p>
	<p>HOME - reload</p>
	<p>TEXT - toggle controls</p>
	<p>FAV - push bookmark</p>
</div>

<div id="result"></div>

<script>
if(typeof(EventSource) !== "undefined") {
	document.getElementById("result").innerHTML = "try...";
    var source = new EventSource("https://script.google.com/macros/s/AKfycbwMQEd6FI91OgLpKBzejeYkkFhSCarWrUh3giJJlxUE42VBr8mJ/exec");
    source.onmessage = function(event) {
        document.getElementById("result").innerHTML += event.data + "<br>";
    };
} else {
    document.getElementById("result").innerHTML = "Sorry, your browser does not support server-sent events...";
}
</script>
1.2

</body>
</html>
